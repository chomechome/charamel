.. image:: https://raw.githubusercontent.com/chomechome/charamel/master/docs/static/logo.png
  :width: 720px

=================================================
üç≠ Fast Universal Encoding Detection in Python üç≠
=================================================


.. image:: https://img.shields.io/pypi/v/charamel.svg
    :target: https://pypi.python.org/pypi/charamel
    :alt: Package version

.. image:: https://img.shields.io/pypi/l/charamel.svg
    :target: https://pypi.python.org/pypi/charamel
    :alt: Package license

.. image:: https://img.shields.io/pypi/pyversions/charamel.svg
    :target: https://pypi.python.org/pypi/charamel
    :alt: Python versions

.. image:: https://travis-ci.org/chomechome/charamel.svg?branch=master
    :target: https://travis-ci.org/chomechome/charamel
    :alt: TravisCI status


-------

**Charamel** is a truly universal character encoding library, with support for `all Python character encodings <https://docs.python.org/3.6/library/codecs.html#standard-encodings>`_ and over 60 languages included. Ain't this sweet?

------------
Installation
------------

::

    $ pip install charamel

-----
Usage
-----

Library API is centered around `Detector` class. Its `detect` method is responsible for basic encoding detection:

.. code-block:: python

    >>> from charamel import Detector, Encoding
    >>> detector = Detector()
    >>> content = b'El espa\xf1ol o castellano del lat\xedn hablado'
    >>> detector.detect(content)
    <Encoding.ISO_8859_14: 'iso8859_14'>
    >>> content.decode(Encoding.ISO_8859_14)
    'El espa√±ol o castellano del lat√≠n hablado'

To get the most probable encodings along with confidences, use `probe` method:

.. code-block:: python

    >>> content = b'El espa\xf1ol o castellano del lat\xedn hablado'
    >>> detector.probe(content, top=3)
    [(<Encoding.ISO_8859_14: 'iso8859_14'>, 0.9964286725192874),
     (<Encoding.CP_1258: 'cp1258'>, 0.9919203166700203),
     (<Encoding.ISO_8859_3: 'iso8859_3'>, 0.9915028923264849)]

`Detector` can be configured to use a subset of encodings, with less encodings leading to faster detection:

.. code-block:: python

    >>> from charamel import Detector, Encoding
    >>> detector = Detector(encodings=[Encoding.UTF_8, Encoding.BIG_5])

Another useful `Detector` parameter is `min_confidence` that takes values in range [0, 1].
Basically, this parameter regulates how conservative `Detector` will be.
Confidence for encodings that are returned by `detect` and `probe` methods must be greater that `min_confidence`.

.. code-block:: python

    >>> from charamel import Detector, Encoding
    >>> detector = Detector(min_confidence=0.5)

If no encodings fit `min_confidence`, `detect` will return `None` and `probe` will return an empty list.

---------
Benchmark
---------

+---------------------------+-----------------------+------------------+------------------+------------+----------------------------------+
| Detector                  |   Supported Encodings |   Seconds / File |   Files / Second | Accuracy   | Accuracy (Supported Encodings)   |
+===========================+=======================+==================+==================+============+==================================+
| Chardet v3.0.4            |                    26 |         0.023203 |               43 | 60%        | 97%                              |
+---------------------------+-----------------------+------------------+------------------+------------+----------------------------------+
| Cchardet v2.1.6           |                    40 |         0.000336 |             2976 | 66%        | 78%                              |
+---------------------------+-----------------------+------------------+------------------+------------+----------------------------------+
| Charset-Normalizer v1.3.4 |                    89 |         0.101531 |               10 | 77%        | 78%                              |
+---------------------------+-----------------------+------------------+------------------+------------+----------------------------------+
| Charamel v0.1.0           |                    98 |         0.007124 |              140 | 97%        | 97%                              |
+---------------------------+-----------------------+------------------+------------------+------------+----------------------------------+


+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| Encoding        |   Total | Chardet v3.0.4   | Cchardet v2.1.6   | Charset-Normalizer v1.3.4   | Charamel v0.1.0   |
+=================+=========+==================+===================+=============================+===================+
| ascii           |       8 | 7 (88%)          | 8 (100%)          | 7 (88%)                     | 8 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| big5            |      33 | 33 (100%)        | 33 (100%)         | 32 (97%)                    | 33 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| big5hkscs       |       9 | 6 (67%) *        | 6 (67%) *         | 8 (89%)                     | 8 (89%)           |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp037           |      14 | 0 (0%) *         | 0 (0%) *          | 12 (86%)                    | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1006          |       4 | 4 (100%) *       | 4 (100%) *        | 4 (100%) *                  | 4 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1026          |      14 | 0 (0%) *         | 0 (0%) *          | 10 (71%)                    | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1125          |       5 | 4 (80%) *        | 4 (80%) *         | 5 (100%)                    | 5 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1140          |      14 | 0 (0%) *         | 0 (0%) *          | 12 (86%)                    | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1250          |      23 | 7 (30%) *        | 22 (96%)          | 11 (48%)                    | 23 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1251          |      45 | 44 (98%)         | 45 (100%)         | 45 (100%)                   | 45 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1252          |      36 | 36 (100%)        | 30 (83%)          | 18 (50%)                    | 36 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1253          |       6 | 4 (67%)          | 6 (100%)          | 6 (100%)                    | 6 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1254          |      16 | 15 (94%) *       | 13 (81%) *        | 12 (75%)                    | 16 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1255          |      29 | 29 (100%)        | 29 (100%)         | 29 (100%)                   | 29 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1256          |       8 | 6 (75%) *        | 7 (88%)           | 8 (100%)                    | 8 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1257          |      13 | 7 (54%) *        | 10 (77%)          | 6 (46%)                     | 13 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp1258          |      15 | 14 (93%) *       | 12 (80%) *        | 12 (80%)                    | 15 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp273           |      14 | 0 (0%) *         | 0 (0%) *          | 7 (50%)                     | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp424           |       4 | 0 (0%) *         | 0 (0%) *          | 4 (100%)                    | 4 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp437           |      11 | 4 (36%) *        | 4 (36%) *         | 9 (82%)                     | 11 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp500           |      14 | 0 (0%) *         | 0 (0%) *          | 7 (50%)                     | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp720           |       6 | 4 (67%) *        | 4 (67%) *         | 6 (100%) *                  | 6 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp737           |       4 | 4 (100%) *       | 4 (100%) *        | 4 (100%) *                  | 4 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp775           |      11 | 4 (36%) *        | 4 (36%) *         | 8 (73%)                     | 11 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp850           |      14 | 4 (29%) *        | 4 (29%) *         | 11 (79%)                    | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp852           |      14 | 4 (29%) *        | 12 (86%)          | 6 (43%)                     | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp855           |      26 | 26 (100%)        | 26 (100%)         | 26 (100%)                   | 26 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp856           |       4 | 4 (100%) *       | 4 (100%) *        | 4 (100%) *                  | 4 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp857           |      14 | 4 (29%) *        | 4 (29%) *         | 11 (79%)                    | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp858           |      14 | 4 (29%) *        | 4 (29%) *         | 11 (79%)                    | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp860           |       7 | 4 (57%) *        | 4 (57%) *         | 6 (86%)                     | 7 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp861           |       9 | 4 (44%) *        | 4 (44%) *         | 8 (89%)                     | 9 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp862           |       4 | 4 (100%) *       | 4 (100%) *        | 4 (100%)                    | 4 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp863           |       7 | 4 (57%) *        | 4 (57%) *         | 6 (86%)                     | 7 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp864           |       4 | 4 (100%) *       | 4 (100%) *        | 4 (100%)                    | 4 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp865           |      12 | 4 (33%) *        | 4 (33%) *         | 10 (83%)                    | 12 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp866           |      23 | 23 (100%)        | 23 (100%)         | 23 (100%)                   | 23 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp869           |       4 | 4 (100%) *       | 4 (100%) *        | 4 (100%)                    | 4 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp874           |       5 | 5 (100%) *       | 5 (100%) *        | 5 (100%) *                  | 5 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp875           |       4 | 0 (0%) *         | 0 (0%) *          | 3 (75%) *                   | 4 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp932           |       8 | 8 (100%)         | 5 (62%) *         | 8 (100%)                    | 6 (75%)           |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp949           |       6 | 6 (100%) *       | 6 (100%)          | 6 (100%)                    | 6 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| cp950           |       6 | 6 (100%) *       | 6 (100%) *        | 6 (100%)                    | 6 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| euc_jis_2004    |      26 | 5 (19%) *        | 5 (19%) *         | 17 (65%)                    | 26 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| euc_jisx0213    |      26 | 5 (19%) *        | 5 (19%) *         | 17 (65%)                    | 26 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| euc_jp          |      53 | 36 (68%)         | 35 (66%)          | 50 (94%)                    | 53 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| euc_kr          |      38 | 38 (100%)        | 38 (100%)         | 37 (97%)                    | 38 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| gb18030         |      42 | 6 (14%) *        | 41 (98%)          | 29 (69%)                    | 42 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| gb2312          |      26 | 25 (96%)         | 24 (92%) *        | 23 (88%)                    | 26 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| gbk             |       9 | 5 (56%) *        | 8 (89%) *         | 8 (89%)                     | 9 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| hz              |       6 | 6 (100%)         | 6 (100%)          | 5 (83%)                     | 6 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso2022_jp      |       7 | 7 (100%)         | 7 (100%)          | 7 (100%)                    | 6 (86%)           |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso2022_jp_1    |      23 | 5 (22%) *        | 5 (22%) *         | 23 (100%)                   | 23 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso2022_jp_2    |      26 | 5 (19%) *        | 5 (19%) *         | 26 (100%)                   | 26 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso2022_jp_2004 |      18 | 5 (28%) *        | 5 (28%) *         | 18 (100%)                   | 18 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso2022_jp_3    |      18 | 5 (28%) *        | 5 (28%) *         | 18 (100%)                   | 18 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso2022_jp_ext  |      23 | 5 (22%) *        | 5 (22%) *         | 23 (100%)                   | 23 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso2022_kr      |       8 | 8 (100%)         | 8 (100%)          | 8 (100%)                    | 8 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_10      |      14 | 9 (64%) *        | 13 (93%)          | 7 (50%)                     | 13 (93%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_11      |       6 | 5 (83%) *        | 6 (100%) *        | 6 (100%)                    | 6 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_13      |      16 | 7 (44%) *        | 14 (88%)          | 6 (38%)                     | 16 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_14      |      14 | 14 (100%) *      | 11 (79%) *        | 12 (86%)                    | 14 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_15      |      18 | 14 (78%) *       | 14 (78%)          | 12 (67%)                    | 18 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_16      |      13 | 8 (62%) *        | 11 (85%)          | 7 (54%)                     | 13 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_2       |      28 | 7 (25%) *        | 27 (96%)          | 16 (57%)                    | 27 (96%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_3       |      13 | 10 (77%) *       | 10 (77%)          | 9 (69%)                     | 13 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_4       |      15 | 9 (60%) *        | 14 (93%)          | 7 (47%)                     | 14 (93%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_5       |      39 | 39 (100%)        | 39 (100%)         | 39 (100%)                   | 39 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_6       |       6 | 4 (67%) *        | 6 (100%)          | 6 (100%)                    | 6 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_7       |      17 | 16 (94%)         | 17 (100%)         | 17 (100%)                   | 17 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_8       |       5 | 5 (100%)         | 5 (100%)          | 4 (80%)                     | 5 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| iso8859_9       |      18 | 14 (78%) *       | 15 (83%)          | 13 (72%)                    | 18 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| johab           |       5 | 4 (80%) *        | 4 (80%) *         | 5 (100%)                    | 5 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| koi8_r          |      26 | 26 (100%)        | 26 (100%)         | 26 (100%)                   | 26 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| koi8_t          |       4 | 4 (100%) *       | 4 (100%) *        | 4 (100%) *                  | 4 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| koi8_u          |       5 | 4 (80%) *        | 4 (80%) *         | 4 (80%) *                   | 5 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| kz1048          |       5 | 4 (80%) *        | 4 (80%) *         | 5 (100%)                    | 5 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| latin_1         |      29 | 29 (100%)        | 26 (90%)          | 24 (83%)                    | 29 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| mac_cyrillic    |      25 | 25 (100%)        | 25 (100%)         | 23 (92%)                    | 25 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| mac_greek       |       7 | 4 (57%) *        | 4 (57%) *         | 6 (86%)                     | 7 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| mac_iceland     |      15 | 4 (27%) *        | 4 (27%) *         | 9 (60%)                     | 15 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| mac_latin2      |      16 | 4 (25%) *        | 11 (69%) *        | 6 (38%)                     | 16 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| mac_roman       |      15 | 4 (27%) *        | 4 (27%) *         | 9 (60%)                     | 15 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| mac_turkish     |      15 | 4 (27%) *        | 4 (27%) *         | 9 (60%)                     | 15 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| ptcp154         |       5 | 4 (80%) *        | 4 (80%) *         | 5 (100%)                    | 5 (100%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| shift_jis       |      37 | 37 (100%)        | 37 (100%)         | 35 (95%)                    | 37 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| shift_jis_2004  |      18 | 5 (28%) *        | 5 (28%) *         | 12 (67%)                    | 18 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| shift_jisx0213  |      18 | 5 (28%) *        | 5 (28%) *         | 12 (67%)                    | 18 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| tis_620         |      11 | 11 (100%)        | 11 (100%) *       | 11 (100%)                   | 11 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| utf_16          |      40 | 40 (100%)        | 40 (100%) *       | 33 (82%)                    | 40 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| utf_16_be       |      42 | 0 (0%) *         | 0 (0%)            | 35 (83%)                    | 27 (64%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| utf_16_le       |      43 | 0 (0%) *         | 0 (0%)            | 35 (81%)                    | 39 (91%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| utf_32          |      42 | 42 (100%)        | 42 (100%) *       | 22 (52%)                    | 41 (98%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| utf_32_be       |      41 | 0 (0%) *         | 0 (0%)            | 20 (49%)                    | 28 (68%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| utf_32_le       |      40 | 0 (0%) *         | 0 (0%)            | 20 (50%)                    | 26 (65%)          |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| utf_7           |      40 | 4 (10%) *        | 4 (10%) *         | 20 (50%)                    | 40 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| utf_8           |     101 | 100 (99%)        | 100 (99%)         | 78 (77%)                    | 101 (100%)        |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+
| utf_8_sig       |      42 | 42 (100%) *      | 42 (100%) *       | 0 (0%) *                    | 42 (100%)         |
+-----------------+---------+------------------+-------------------+-----------------------------+-------------------+

\* - not officially supported for detector